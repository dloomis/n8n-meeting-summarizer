{
  "name": "Meeting Summarizer",
  "nodes": [
    {
      "parameters": {
        "dataType": "boolean",
        "value1": true,
        "rules": {
          "rules": [
            {
              "value2": "={{ $json.isFocusedNote }}",
              "output": 1
            },
            {
              "value2": "={{ $json.evergreenTopic }}",
              "output": 2
            }
          ]
        },
        "fallbackOutput": 0
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 1,
      "position": [
        192,
        752
      ],
      "id": "16629f69-e03c-4801-a9e1-e98de1b478ee",
      "name": "Route by Type"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "claude-sonnet-4-5-20250929",
          "mode": "list",
          "cachedResultName": "Claude Sonnet 4.5"
        },
        "options": {
          "temperature": 0.2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        720,
        1360
      ],
      "id": "43cdc6e7-6bff-4ac6-9cbf-d4159b1424b6",
      "name": "Claude Sonnet 4.5"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "qwen/qwen3-30b-a3b-2507",
          "mode": "list",
          "cachedResultName": "qwen/qwen3-30b-a3b-2507"
        },
        "responsesApiEnabled": false,
        "options": {
          "temperature": 0.2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        1152,
        1360
      ],
      "id": "3ffda992-387b-455a-8298-2a8914ed6340",
      "name": "qwen/qwen3-30b-a3b-"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "claude-opus-4-5-20251101",
          "mode": "list",
          "cachedResultName": "Claude Opus 4.5"
        },
        "options": {
          "temperature": 0.5
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        864,
        1360
      ],
      "id": "b27edb42-3195-42d2-b9df-940fb6dc75e9",
      "name": "Claude Opus 4.5"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=## CONCEPT TO EXTRACT\n{{ $('Workflow Data').item.json.evergreenTopic }}\n\n## SOURCE TRANSCRIPT\n<transcript>\n{{ $('Workflow Data').item.json.formattedTranscript }}\n</transcript>\n\nGenerate the evergreen note now.",
        "options": {
          "systemMessage": "={{ $json.data }}",
          "maxIterations": 5
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        864,
        992
      ],
      "id": "42631f5f-2aed-4ffe-b639-e3b6e716b6aa",
      "name": "Create Evergreen Note"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "claude-haiku-4-5-20251001",
          "mode": "list",
          "cachedResultName": "Claude Haiku 4.5"
        },
        "options": {
          "temperature": 0.5
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        1008,
        1360
      ],
      "id": "bd99749e-5401-4844-84a9-5713e972f50d",
      "name": "Claude Haiku 4.5"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "llama-3.3-70b-instruct",
          "mode": "list",
          "cachedResultName": "llama-3.3-70b-instruct"
        },
        "responsesApiEnabled": false,
        "options": {
          "temperature": 0.5
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        1296,
        1360
      ],
      "id": "55f4ae9b-0ba2-4a06-b6dd-55ee589bc8cc",
      "name": "llama 3.3 70b instruct"
    },
    {
      "parameters": {
        "operation": "toText",
        "sourceProperty": "output",
        "options": {
          "encoding": "utf8",
          "fileName": "={{ $('Workflow Data').item.json.obsidianNoteName }}"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        1280,
        768
      ],
      "id": "14569d25-b70b-4023-9f8e-515ba7238126",
      "name": "Convert to File"
    },
    {
      "parameters": {
        "operation": "write",
        "fileName": "={{ $('Workflow Data').item.json.obsidianNoteFolder }}{{ $('Workflow Data').item.json.obsidianNoteName }}",
        "options": {}
      },
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1,
      "position": [
        1504,
        768
      ],
      "id": "4e3d9f40-cc22-4a2a-bd9e-7e01cbee7598",
      "name": "Write to Obsidian"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Summarize this meeting transcript following the OUTPUT TEMPLATE exactly.\n\n**Context:**\n- Default due date: {{ $now.plus({days: 7}).toFormat('yyyy-MM-dd') }}\n- Participants: {{ $('Workflow Data').item.json.participantsHint.join(', ') }}\n- Meeting date: {{ $('Workflow Data').item.json.extractedDate }}\n- Priority participants: {{ $('Workflow Data').item.json.importantParticipants.join(', ') }}\n\n**Transcript:**\n{{ $('Workflow Data').item.json.formattedTranscript }}\n\nGenerate the summary now using the exact structure in OUTPUT TEMPLATE.",
        "options": {
          "systemMessage": "={{ $json.data }}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        864,
        528
      ],
      "id": "274c597a-623b-49e8-bccd-7617a51ad49c",
      "name": "Create Summary Note"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "f0675b51-51ca-4cc1-a333-4317e3ffbfcf",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -256,
        304
      ],
      "id": "5bfd4134-6b9c-4e74-8c49-abdb91232d4d",
      "name": "Webhook",
      "webhookId": "f0675b51-51ca-4cc1-a333-4317e3ffbfcf"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "filenameNoExt",
              "name": "transcriptTitle",
              "value": "={{ $('Parse Transcript').item.json.title }}",
              "type": "string"
            },
            {
              "id": "participantsHint",
              "name": "participantsHint",
              "value": "={{ $('Parse Transcript').item.json.participants }}",
              "type": "array"
            },
            {
              "id": "extractedDate",
              "name": "extractedDate",
              "value": "={{ $('Parse Transcript').item.json.extractedDate }}",
              "type": "string"
            },
            {
              "id": "importantParticipants",
              "name": "importantParticipants",
              "value": "={{ $('Parse Arguments').item.json.importantParticipants }}",
              "type": "array"
            },
            {
              "id": "038b8982-ad28-4310-9612-8cee5e732cd3",
              "name": "isEvergreenNote",
              "value": "={{ $('Parse Arguments').item.json.evergreenTopic !== null }}",
              "type": "boolean"
            },
            {
              "id": "bf7ecb5b-8118-430f-95e5-3b81f5f54264",
              "name": "isFocusedNote",
              "value": "={{ $('Parse Arguments').item.json.focusedTopic !== null }}",
              "type": "boolean"
            },
            {
              "id": "e689e5d0-6be1-4845-a843-330bd4393fa7",
              "name": "evergreenTopic",
              "value": "={{ $('Parse Arguments').item.json.evergreenTopic }}",
              "type": "string"
            },
            {
              "id": "674ca0cf-20e5-4ad5-b86b-aee952c7ec43",
              "name": "focusedTopic",
              "value": "={{ $('Parse Arguments').item.json.focusedTopic }}",
              "type": "string"
            },
            {
              "id": "1b5b48f2-8bb2-48b2-a21e-f0f9860f1d95",
              "name": "obsidianNoteFolder",
              "value": "={{ $('Parse Arguments').item.json.evergreenTopic != null || $('Parse Arguments').item.json.focusedTopic != null ? '/data/evergreen/' : '/data/summaries/' }}",
              "type": "string"
            },
            {
              "id": "dece3c98-d80e-4145-80e2-c66b05fc824b",
              "name": "obsidianNoteName",
              "value": "={{ $('Parse Transcript').item.json.title + '.' + $json.data.substring(0,6) + '.md' }}",
              "type": "string"
            },
            {
              "id": "ea66a226-889c-4ddd-99bc-77a95bd6c40f",
              "name": "=formattedTranscript",
              "value": "={{ $('Parse Transcript').item.json.formattedTranscript }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        864,
        304
      ],
      "id": "98bf5ef0-4f41-49e2-9d80-8003761d76f2",
      "name": "Workflow Data"
    },
    {
      "parameters": {
        "content": "Set your credentials for each of the models you want to use in this workflow.",
        "height": 80
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        32,
        1120
      ],
      "typeVersion": 1,
      "id": "1a3b4322-ace2-4dc4-9d3a-a5e522d092c1",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "Point to your own Github repo if you don't want to use the prompts from the main project.",
        "height": 80
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        416,
        208
      ],
      "typeVersion": 1,
      "id": "cc19a318-1270-4eed-bfc1-02920483901f",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "The prompts are optimized for Claude Sonnet and Opus. They should be modified for best performance if using another model.",
        "height": 112
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        864,
        176
      ],
      "typeVersion": 1,
      "id": "53070374-f20f-4ce2-a938-2268d86d70e7",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "TODO: use Obsidian node to use RESTI API calls instead of local file operations",
        "height": 80
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1488,
        560
      ],
      "typeVersion": 1,
      "id": "fec76cd4-39b2-472d-b2c5-baac4c4b886c",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "Local file operations require specific compose.yml env variables (see readme)",
        "height": 80
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1264,
        1040
      ],
      "typeVersion": 1,
      "id": "7719e64a-a858-4cc6-bdf5-e310785b6370",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "content": "Internet search for Evergreen Note creation uses a lot of tokens! Disabled for now.",
        "height": 80
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1152,
        1184
      ],
      "typeVersion": 1,
      "id": "01a01bd3-42dd-4135-9d70-e64c759a314d",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "url": "https://api.search.brave.com/res/v1/web/search",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "q",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', `The search query for real-time information on the evergreen topic`, 'string') }}"
            },
            {
              "name": "count",
              "value": "5"
            },
            {
              "name": "country",
              "value": "US"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-Subscription-Token"
            },
            {
              "name": "Accept",
              "value": "application/json"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        1008,
        1184
      ],
      "id": "ba901351-e0db-427f-b415-68eb3bea7944",
      "name": "Internet Search"
    },
    {
      "parameters": {
        "action": "generate"
      },
      "type": "n8n-nodes-base.crypto",
      "typeVersion": 1,
      "position": [
        640,
        304
      ],
      "id": "3ed0c561-d230-4dfc-8494-e765e471b54d",
      "name": "Generate filename UUID"
    },
    {
      "parameters": {
        "jsCode": "return items.map(item => {\n    const title = item.json.body?.title || '';\n    const transcript = item.json.body?.transcript || '';\n    let participants = [];\n    let extractedDate = null;\n    let formattedTranscript = '';\n    \n    // Split into blocks (assuming double newlines separate speakers)\n    const blocks = transcript.split(/\\n\\n/).filter(b => b.trim());\n    \n    // Extract participants and format\n    participants = [...new Set(blocks.map(b => b.split('\\n')[0]?.trim()).filter(p => p && p !== 'Unknown'))];\n    formattedTranscript = blocks.length \n        ? blocks.map(b => {\n            const lines = b.split('\\n');\n            const speaker = lines[0]?.trim() || 'Unknown';\n            const text = lines.slice(1).join('\\n').trim();\n            return `${speaker}: ${text}`;\n        }).join('\\n\\n')\n        : 'No transcript available.';\n    \n    // Extract date from title\n    const titleDateRegex = /\\b(\\d{4}-\\d{2}-\\d{2})\\b/;\n    extractedDate = title.match(titleDateRegex) ? title.match(titleDateRegex)[0] : new Date().toISOString().split('T')[0];\n    \n    return {\n        json: {\n            participants,\n            extractedDate,\n            title,\n            formattedTranscript\n        }\n    };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -32,
        304
      ],
      "id": "8583c9c7-5d17-4e8a-9264-f509c765f450",
      "name": "Parse Transcript"
    },
    {
      "parameters": {
        "jsCode": "return items.map(item => {\n    const filename = item.json.title || '';\n    \n    // Parses a filename for people after '!' , evergreen topic after '#', and focused topic after '+'.\n    // #, !, and + are optional and can be used separately.\n    function parseFilename(filename) {\n        let importantParticipants = [];\n        let evergreenTopic = null;\n        let focusedTopic = null;  // NEW: For +topic\n        \n        // Find '!' for importantParticipants\n        const bangIndex = filename.indexOf('!');\n        if (bangIndex !== -1) {\n            const namePart = filename.substring(bangIndex + 1); // Everything after !\n            importantParticipants = namePart.split(',')\n                .map(name => name.trim())\n                .filter(name => name.length > 0);\n        }\n        \n        // Find '#' for evergreenTopic\n        const hashIndex = filename.indexOf('#');\n        if (hashIndex !== -1) {\n            evergreenTopic = filename.substring(hashIndex + 1).trim(); // Everything after #\n        }\n        \n        // NEW: Find '+' for focusedTopic (logic exactly like #)\n        const plusIndex = filename.indexOf('+');\n        if (plusIndex !== -1) {\n            focusedTopic = filename.substring(plusIndex + 1).trim(); // Everything after +, multi-word support\n        }\n        \n        return {\n            importantParticipants,\n            evergreenTopic,\n            focusedTopic  // NEW\n        };\n    }\n    \n    const { importantParticipants, evergreenTopic, focusedTopic } = parseFilename(filename);\n    \n    return {\n        json: {\n            importantParticipants,\n            evergreenTopic,\n            focusedTopic  // NEW: Add to output JSON\n        }\n    };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        192,
        304
      ],
      "id": "742f5b73-c379-4e05-b88c-d228297f4974",
      "name": "Parse Arguments"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "df8b4cc9-259b-4f06-8763-f030ce58a76c",
              "name": "meetingSummaryPromptURL",
              "value": "https://raw.githubusercontent.com/dloomis/n8n-meeting-summarizer/main/summary-system-prompt.md",
              "type": "string"
            },
            {
              "id": "c80e2150-1299-40f7-be71-ffc4baeccf62",
              "name": "evergreenPromptURL",
              "value": "https://raw.githubusercontent.com/dloomis/n8n-meeting-summarizer/main/evergreen-system-prompt.md",
              "type": "string"
            },
            {
              "id": "e3abf064-8333-44dc-9781-a2b1f55ee91d",
              "name": "focusedTopicPromptURL",
              "value": "https://raw.githubusercontent.com/dloomis/n8n-meeting-summarizer/main/focused-system-prompt.md",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        416,
        304
      ],
      "id": "8c0902df-ae8c-4bd8-a95e-801fe35b7f23",
      "name": "Workflow Variables"
    },
    {
      "parameters": {
        "content": "Reference this webhook URL in MacWhisper or your favorite audio transcription tool.",
        "height": 80
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -256,
        208
      ],
      "typeVersion": 1,
      "id": "faa4bafd-e122-4095-bc6a-acb5425d2492",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "url": "={{ $('Workflow Variables').item.json.meetingSummaryPromptURL }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "githubApi",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        528,
        528
      ],
      "id": "59350a32-015d-443f-9d90-cf7ac9d9e417",
      "name": "Fetch Summary Prompt"
    },
    {
      "parameters": {
        "url": "={{ $('Workflow Variables').item.json.evergreenPromptURL }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "githubApi",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        528,
        992
      ],
      "id": "d5cf0345-46ff-439f-b60d-f8dd560e3a8b",
      "name": "Fetch Evergreen Prompt"
    },
    {
      "parameters": {
        "url": "={{ $('Workflow Variables').item.json.focusedTopicPromptURL }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "githubApi",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        528,
        768
      ],
      "id": "5e383a1d-f82d-45f8-8946-fe6b106cd017",
      "name": "Fetch Focused Topic Prompt"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Analyze the following meeting transcript for a deep learning dive on this topic:\n\nTOPIC: {{ $('Workflow Data').item.json.focusedTopic }}\n\nTRANSCRIPT: {{ $('Workflow Data').item.json.formattedTranscript }}\n\nProvide a comprehensive technical explanation of this topic based on the discussion in the transcript, including all relevant DoD/military context, technical specifications, and key insights from the conversation.",
        "options": {
          "systemMessage": "={{ $json.data }}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        864,
        768
      ],
      "id": "0f3dba5e-7f9a-4435-b5e1-e9cf693f4c1e",
      "name": "Create Focused Note"
    }
  ],
  "pinData": {},
  "connections": {
    "Route by Type": {
      "main": [
        [
          {
            "node": "Fetch Summary Prompt",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fetch Focused Topic Prompt",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fetch Evergreen Prompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Claude Sonnet 4.5": {
      "ai_languageModel": [
        [
          {
            "node": "Create Summary Note",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Create Focused Note",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Claude Opus 4.5": {
      "ai_languageModel": [
        [
          {
            "node": "Create Evergreen Note",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Create Evergreen Note": {
      "main": [
        [
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File": {
      "main": [
        [
          {
            "node": "Write to Obsidian",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Summary Note": {
      "main": [
        [
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Parse Transcript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Workflow Data": {
      "main": [
        [
          {
            "node": "Route by Type",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate filename UUID": {
      "main": [
        [
          {
            "node": "Workflow Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Transcript": {
      "main": [
        [
          {
            "node": "Parse Arguments",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Arguments": {
      "main": [
        [
          {
            "node": "Workflow Variables",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Workflow Variables": {
      "main": [
        [
          {
            "node": "Generate filename UUID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Summary Prompt": {
      "main": [
        [
          {
            "node": "Create Summary Note",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Evergreen Prompt": {
      "main": [
        [
          {
            "node": "Create Evergreen Note",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Focused Topic Prompt": {
      "main": [
        [
          {
            "node": "Create Focused Note",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Focused Note": {
      "main": [
        [
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false
  },
  "versionId": "a68ca0e7-d097-4fc3-b6cf-351b25dc08d5",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "fc95f5dcf8564dad8406657e222d807a38320c03e61ffe53bddcf6037399e437"
  },
  "id": "eQXiPWGAUdrJLVEo",
  "tags": []
}