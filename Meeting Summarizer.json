{
  "name": "Meeting Summarizer - Dev",
  "nodes": [
    {
      "parameters": {
        "dataType": "boolean",
        "value1": true,
        "rules": {
          "rules": [
            {
              "value2": "={{ $json.isEvergreenNote }}",
              "output": 1
            }
          ]
        },
        "fallbackOutput": 0
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 1,
      "position": [
        -1136,
        -496
      ],
      "id": "21b79861-ec42-44d3-9e75-c0c4a56430fc",
      "name": "Route by Type"
    },
    {
      "parameters": {
        "url": "={{ $json.getEvergreenSystemPromptURL }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        -848,
        -368
      ],
      "id": "9b221039-be12-4068-ad38-92d138af1b13",
      "name": "Fetch Evergreen Prompt"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "claude-sonnet-4-5-20250929",
          "mode": "list",
          "cachedResultName": "Claude Sonnet 4.5"
        },
        "options": {
          "temperature": 0.2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        -784,
        16
      ],
      "id": "8d167dbc-a351-451d-bb9b-56dcf47de3c3",
      "name": "Claude Sonnet 4.5"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "qwen/qwen3-30b-a3b-2507",
          "mode": "list",
          "cachedResultName": "qwen/qwen3-30b-a3b-2507"
        },
        "responsesApiEnabled": false,
        "options": {
          "temperature": 0.2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -352,
        16
      ],
      "id": "adceeb60-30ee-4d07-a934-b62c330c49fd",
      "name": "qwen/qwen3-30b-a3b-"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "claude-opus-4-5-20251101",
          "mode": "list",
          "cachedResultName": "Claude Opus 4.5"
        },
        "options": {
          "temperature": 0.5
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        -640,
        16
      ],
      "id": "b32e03fd-fe5c-4777-8b81-7134673631d7",
      "name": "Claude Opus 4.5"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=## CONCEPT TO EXTRACT\n{{ $('Store file info (UPDATE ME)').item.json.evergreenTopic }}\n\n## SOURCE TRANSCRIPT\n<transcript>\n{{ $('Store file info (UPDATE ME)').item.json.formattedTranscript }}\n</transcript>\n\nGenerate the evergreen note now.",
        "options": {
          "systemMessage": "={{ $json.data }}",
          "maxIterations": 5
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -640,
        -368
      ],
      "id": "43aa9c55-2d7f-4c0f-a2c0-f28db7197c22",
      "name": "Create Evergreen Note"
    },
    {
      "parameters": {
        "url": "={{ $json.gitSummarySystemPromptURL }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        -848,
        -608
      ],
      "id": "74cc96fd-e0e5-4ff0-837b-2a63a0e98b54",
      "name": "Fetch Summary Prompt"
    },
    {
      "parameters": {
        "jsCode": "return items.map(item => {\n    const filename = item.json.title || '';\n    \n    /**\n     * Parses a filename for person names after '!' and evergreen topic after '#'.\n     * Names are extracted after '!' until '#' or end, split by commas.\n     * Topic is extracted after the last '#' if present.\n     * @param {string} filename - The filename to parse (without extension)\n     * @returns {object} Object with 'names' array and 'evergreenTopic' string or null\n     */\n    function parseFilename(filename) {\n        let names = [];\n        let evergreenTopic = null;\n        \n        // Find '!' for names\n        const bangIndex = filename.indexOf('!');\n        if (bangIndex !== -1) {\n            let namePart = '';\n            for (let i = bangIndex + 1; i < filename.length; i++) {\n                if (filename[i] === '#') {\n                    break;\n                }\n                namePart += filename[i];\n            }\n            names = namePart.split(',')\n                .map(name => name.trim())\n                .filter(name => name.length > 0);\n        }\n        \n        // Find last '#' for evergreen topic\n        const hashIndex = filename.lastIndexOf('#');\n        if (hashIndex !== -1) {\n            evergreenTopic = filename.substring(hashIndex + 1).trim();\n        }\n        \n        return {\n            names,\n            evergreenTopic\n        };\n    }\n    \n    const { names, evergreenTopic } = parseFilename(filename);\n    \n    return {\n        json: {\n            names,\n            evergreenTopic,\n            ...item.json\n     \n        }\n    };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -720,
        -848
      ],
      "id": "f6a6a135-5b63-4dfe-b68c-0dada7e6a5ad",
      "name": "Parse file name arguments"
    },
    {
      "parameters": {
        "jsCode": "return items.map(item => {\n    const title = item.json.body?.title || '';\n    const transcript = item.json.body?.transcript || '';\n    let participants = [];\n    let extractedDate = null;\n    let formattedTranscript = '';\n    \n    // Split into blocks (assuming double newlines separate speakers)\n    const blocks = transcript.split(/\\n\\n/).filter(b => b.trim());\n    \n    // Extract participants and format\n    participants = [...new Set(blocks.map(b => b.split('\\n')[0]?.trim()).filter(p => p && p !== 'Unknown'))];\n    formattedTranscript = blocks.length \n        ? blocks.map(b => {\n            const lines = b.split('\\n');\n            const speaker = lines[0]?.trim() || 'Unknown';\n            const text = lines.slice(1).join('\\n').trim();\n            return `${speaker}: ${text}`;\n        }).join('\\n\\n')\n        : 'No transcript available.';\n    \n    // Extract date from title\n    const titleDateRegex = /\\b(\\d{4}-\\d{2}-\\d{2})\\b/;\n    extractedDate = title.match(titleDateRegex) ? title.match(titleDateRegex)[0] : new Date().toISOString().split('T')[0];\n    \n    return {\n        json: {\n            participants,\n            extractedDate,\n            title,\n            formattedTranscript\n        }\n    };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -928,
        -848
      ],
      "id": "4392f8dc-8744-48d8-ba0b-7a3a57fb68c8",
      "name": "Parse Metadata"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "gitSystemPromptURL",
              "name": "gitSummarySystemPromptURL",
              "value": "https://raw.githubusercontent.com/dloomis/n8n-meeting-summarizer/main/system-prompt.md",
              "type": "string"
            },
            {
              "id": "76145651-6504-45f1-977e-6310ddce78cc",
              "name": "getEvergreenSystemPromptURL",
              "value": "https://raw.githubusercontent.com/dloomis/n8n-meeting-summarizer/main/evergreen-prompt.md",
              "type": "string"
            },
            {
              "id": "filenameNoExt",
              "name": "title",
              "value": "={{ $json.title }}",
              "type": "string"
            },
            {
              "id": "participantsHint",
              "name": "participantsHint",
              "value": "={{ $json.participants }}",
              "type": "array"
            },
            {
              "id": "extractedDate",
              "name": "extractedDate",
              "value": "={{ $json.extractedDate }}",
              "type": "string"
            },
            {
              "id": "importantParticipants",
              "name": "importantParticipants",
              "value": "={{ $json.names }}",
              "type": "array"
            },
            {
              "id": "038b8982-ad28-4310-9612-8cee5e732cd3",
              "name": "isEvergreenNote",
              "value": "={{ $json.evergreenTopic !== null }}",
              "type": "boolean"
            },
            {
              "id": "e689e5d0-6be1-4845-a843-330bd4393fa7",
              "name": "evergreenTopic",
              "value": "={{ $json.evergreenTopic }}",
              "type": "string"
            },
            {
              "id": "1b5b48f2-8bb2-48b2-a21e-f0f9860f1d95",
              "name": "obsidianNoteFolder",
              "value": "={{ $json.evergreenTopic == null ? '/data/summaries/' : '/data/evergreen/' }}",
              "type": "string"
            },
            {
              "id": "dece3c98-d80e-4145-80e2-c66b05fc824b",
              "name": "obsidianNoteName",
              "value": "={{ $json.evergreenTopic == null ? $json.title + '.' + Math.floor(Math.random() * 1000) + '.md' : '[EDIT THIS FILE].' + $json.title + '.md' }}",
              "type": "string"
            },
            {
              "id": "ea66a226-889c-4ddd-99bc-77a95bd6c40f",
              "name": "=formattedTranscript",
              "value": "={{ $('Parse Metadata').item.json.formattedTranscript }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -512,
        -848
      ],
      "id": "36562c0d-e724-4ba6-b15e-3d3c0365865a",
      "name": "Store file info (UPDATE ME)"
    },
    {
      "parameters": {
        "url": "https://api.search.brave.com/res/v1/web/search",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "q",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', `The search query for real-time information on the evergreen topic`, 'string') }}"
            },
            {
              "name": "count",
              "value": "5"
            },
            {
              "name": "country",
              "value": "US"
            }
          ]
        },
        "sendHeaders": true,
         "headerParameters": {
           "parameters": [
             {
               "name": "Accept",
               "value": "application/json"
             }
           ]
         },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        -496,
        -160
      ],
      "id": "ff0277a4-d75c-417c-8f11-88b2c34eef4b",
      "name": "HTTP Request1"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "claude-haiku-4-5-20251001",
          "mode": "list",
          "cachedResultName": "Claude Haiku 4.5"
        },
        "options": {
          "temperature": 0.5
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        -496,
        16
      ],
      "id": "c612fa15-2352-4a9a-9664-81a1e9055892",
      "name": "Claude Haiku 4.5"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "llama-3.3-70b-instruct",
          "mode": "list",
          "cachedResultName": "llama-3.3-70b-instruct"
        },
        "responsesApiEnabled": false,
        "options": {
          "temperature": 0.5
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -208,
        16
      ],
      "id": "e6f3d10e-fe9b-4dad-b116-308d571de399",
      "name": "llama 3.3 70b instruct"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "f0675b51-51ca-4cc1-a333-4317e3ffbfcf",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -1136,
        -848
      ],
      "id": "f3600809-7acf-46b1-9184-f23a2851c43c",
      "name": "Webhook (UPDATE ME)",
      "webhookId": "f0675b51-51ca-4cc1-a333-4317e3ffbfcf"
    },
    {
      "parameters": {
        "operation": "toText",
        "sourceProperty": "output",
        "options": {
          "encoding": "utf8",
          "fileName": "={{ $('Store file info (UPDATE ME)').item.json.obsidianNoteName }}"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -256,
        -480
      ],
      "id": "bf7ba41a-6918-4907-a961-aa4bf681677b",
      "name": "Convert to File"
    },
    {
      "parameters": {
        "operation": "write",
        "fileName": "={{ $('Store file info (UPDATE ME)').item.json.obsidianNoteFolder }}{{ $('Store file info (UPDATE ME)').item.json.obsidianNoteName }}",
        "options": {}
      },
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1,
      "position": [
        -48,
        -480
      ],
      "id": "988fddb8-994e-4bed-aa7f-bccbbdf2ee84",
      "name": "Write to Obsidian"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Summarize this meeting transcript following the OUTPUT TEMPLATE exactly.\n\n**Context:**\n- Default due date: {{ $now.plus({days: 7}).toFormat('yyyy-MM-dd') }}\n- Participants: {{ $('Store file info (UPDATE ME)').item.json.participantsHint.join(', ') }}\n- Meeting date: {{ $('Store file info (UPDATE ME)').item.json.extractedDate }}\n- Priority participants: {{ $('Store file info (UPDATE ME)').item.json.importantParticipants.join(', ') }}\n\n**Transcript:**\n{{ $('Store file info (UPDATE ME)').item.json.formattedTranscript }}\n\nGenerate the summary now using the exact structure in OUTPUT TEMPLATE.",
        "options": {
          "systemMessage": "={{ $json.data }}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -640,
        -608
      ],
      "id": "7bf3b5e1-f463-4ab4-beb1-ad12bea51044",
      "name": "Create Summary Note"
    }
  ],
  "pinData": {},
  "connections": {
    "Route by Type": {
      "main": [
        [
          {
            "node": "Fetch Summary Prompt",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fetch Evergreen Prompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Evergreen Prompt": {
      "main": [
        [
          {
            "node": "Create Evergreen Note",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Claude Sonnet 4.5": {
      "ai_languageModel": [
        [
          {
            "node": "Create Summary Note",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Claude Opus 4.5": {
      "ai_languageModel": [
        [
          {
            "node": "Create Evergreen Note",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Create Evergreen Note": {
      "main": [
        [
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Summary Prompt": {
      "main": [
        [
          {
            "node": "Create Summary Note",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse file name arguments": {
      "main": [
        [
          {
            "node": "Store file info (UPDATE ME)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Metadata": {
      "main": [
        [
          {
            "node": "Parse file name arguments",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Store file info (UPDATE ME)": {
      "main": [
        [
          {
            "node": "Route by Type",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook (UPDATE ME)": {
      "main": [
        [
          {
            "node": "Parse Metadata",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File": {
      "main": [
        [
          {
            "node": "Write to Obsidian",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Summary Note": {
      "main": [
        [
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "ad088ee9-ab4e-404c-905e-3d2746fa2145",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "fc95f5dcf8564dad8406657e222d807a38320c03e61ffe53bddcf6037399e437"
  },
  "id": "ujL8ZbtG6mD6Lh7W",
  "tags": []
}
